# Протокол V2



## I. Заголовок пакета

| Байт  | Тип      | Идентификтор     | Описание                            |
| ----- | -------- | ---------------- | ----------------------------------- |
| 00    | uint8_t  | protocol_version | Версия протокола                    |
| 01-05 | uint32_t | id               | Идентификтор устройства, 0 для базы |
| 06    | uint8_t  | package_type     | Тип пакета                          |



## II. Типы пакетов

### 0x01: Echo 

Информация устройства о себя. Посылается устройством

| Байт  | Тип       | Идентификтор | Описание                  |
| ----- | --------- | ------------ | ------------------------- |
| 07-10 | uint32_t  | unix_time    | время в формате UNIX      |
| 11-14 | float32_t | pos_lat      | широта в градусах, WGS84  |
| 15-18 | float32_t | pos_lon      | долгота в градусах, WGS84 |
| 19-20 | uint16_t  | txpower      | мощность излучателя, мВт  |
| 21-63 |           | reserved     |                           |



### 0x02: Request info

Запрос информации от другого устройства. Посылается устройством или базой.

| Байт  | Тип      | Идентификтор | Описание                               |
| ----- | -------- | ------------ | -------------------------------------- |
| 07-10 | uint32_t | target_id    | Идентификатор опрашиваемого устройства |
| 11-63 |          | reserved     |                                        |



### 0x03: Change transmit method

Смена режима передачи. Посылается базой.

| Байт  | Тип      | Идентификтор | Описание                          |
| ----- | -------- | ------------ | --------------------------------- |
| 07-10 | uint32_t | target_id    | Идентификатор целевого устройства |
| 11-14 | uint32_t | frequency    | Частота несущей, МГц              |
| 15-16 | uint16_t | channel_id   | Номер канала                      |
| 17-18 | uint16_t | txpower      | мощность излучателя, мВт          |
| 19-63 |          | reserved     |                                   |



### 0x04: Event occured

Срабатывание датчика. Посылается устройством.

| Байт  | Тип      | Идентификтор | Описание                                 |
| ----- | -------- | ------------ | ---------------------------------------- |
| 07-10 | uint32_t | event_id     | Идентификатор результата                 |
| 11-14 | uint32_t | time         | Количество секунд начиная с 01.01.1970 00:00:00 |
| 15-16 | uint16_t | msec         | Количество миллисекунд                   |
| 17-63 |          | reserved     |                                          |



### 0x05: Event received

Получение результата. Посылается базой.

| Байт  | Тип      | Идентификтор | Описание                          |
| ----- | -------- | ------------ | --------------------------------- |
| 07-10 | uint32_t | target_id    | Идентификатор целевого устройства |
| 11-14 | uint16_t | event_id     | Идентификатор принятого события   |
| 15-63 |          | reserved     |                                   |

